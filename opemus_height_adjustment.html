<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enlarger Exposure Calculator</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="darkroom.css">
  <style>
    .unit-toggle {
      display: flex;
      gap: 15px;
      margin: 15px 0;
      align-items: center;
      justify-content: center;
    }
    .unit-toggle label {
      display: flex;
      align-items: center;
      gap: 5px;
      margin: 0;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Enlarger Exposure Calculator</h1>
  <div class="nav-link"><a href="index.html">← Back to tools</a></div>

  <div class="unit-toggle">
    <label>
      <input type="radio" name="unit" value="inches" id="inchesRadio" checked onchange="setUnit('inches')">
      Inches
    </label>
    <label>
      <input type="radio" name="unit" value="cm" id="cmRadio" onchange="setUnit('cm')">
      Centimeters
    </label>
  </div>

  <label for="negativeType">Negative Type:</label>
  <select id="negativeType" onchange="saveSettings()">
    <option value="35mm">35mm</option>
    <option value="6x6">6x6 120mm</option>
  </select>

  <label for="initialWidth">Initial Print Width:</label>
  <input type="number" id="initialWidth" step="0.1" placeholder="Enter initial width" onchange="saveSettings()">

  <label for="targetWidth">Target Print Width:</label>
  <input type="number" id="targetWidth" step="0.1" placeholder="Enter target width" onchange="saveSettings()">

  <label for="initialExposure">Initial Exposure Time (s):</label>
  <input type="number" id="initialExposure" step="0.1" placeholder="Enter exposure time" onchange="saveSettings()">

  <button onclick="calculateExposure()">Calculate Target Exposure</button>

  <p id="result"></p>

  <script>
    // Negative sizes in inches
    const negativeSizes = {
      '35mm': 1.42,
      '6x6': 2.35
    };

    let currentUnit = 'inches';

    // Cookie functions
    function setCookie(name, value, days) {
      const expires = new Date();
      expires.setTime(expires.getTime() + days * 24 * 60 * 60 * 1000);
      document.cookie = `${name}=${value};expires=${expires.toUTCString()};path=/`;
    }

    function getCookie(name) {
      const nameEQ = name + "=";
      const ca = document.cookie.split(';');
      for (let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
      }
      return null;
    }

    function saveSettings() {
      const settings = {
        unit: currentUnit,
        negativeType: document.getElementById('negativeType').value,
        initialWidth: document.getElementById('initialWidth').value,
        targetWidth: document.getElementById('targetWidth').value,
        initialExposure: document.getElementById('initialExposure').value
      };
      setCookie('enlargerCalcSettings', JSON.stringify(settings), 365);
    }

    function loadSettings() {
      const settingsStr = getCookie('enlargerCalcSettings');
      if (settingsStr) {
        try {
          const settings = JSON.parse(settingsStr);

          // Restore unit
          if (settings.unit) {
            currentUnit = settings.unit;
            if (settings.unit === 'inches') {
              document.getElementById('inchesRadio').checked = true;
            } else {
              document.getElementById('cmRadio').checked = true;
            }
          }

          // Restore negative type
          if (settings.negativeType) {
            document.getElementById('negativeType').value = settings.negativeType;
          }

          // Restore input values
          if (settings.initialWidth) {
            document.getElementById('initialWidth').value = settings.initialWidth;
          }
          if (settings.targetWidth) {
            document.getElementById('targetWidth').value = settings.targetWidth;
          }
          if (settings.initialExposure) {
            document.getElementById('initialExposure').value = settings.initialExposure;
          }
        } catch (e) {
          console.error('Error loading settings:', e);
        }
      }
    }

    function setUnit(unit) {
      currentUnit = unit;
      saveSettings();
    }

    function calculateExposure() {
      const initialWidth = parseFloat(document.getElementById('initialWidth').value);
      const targetWidth = parseFloat(document.getElementById('targetWidth').value);
      const initialExposure = parseFloat(document.getElementById('initialExposure').value);
      const negativeType = document.getElementById('negativeType').value;

      if (isNaN(initialWidth) || isNaN(targetWidth) || isNaN(initialExposure)) {
        document.getElementById('result').innerText = 'Please enter valid numbers for all fields.';
        return;
      }

      if (initialWidth <= 0 || targetWidth <= 0 || initialExposure <= 0) {
        document.getElementById('result').innerText = 'All values must be positive.';
        return;
      }

      // Get negative size in inches
      let negativeSize = negativeSizes[negativeType];

      // Convert widths to inches if in cm
      let initialWidthInches = initialWidth;
      let targetWidthInches = targetWidth;

      if (currentUnit === 'cm') {
        initialWidthInches = initialWidth / 2.54;
        targetWidthInches = targetWidth / 2.54;
      }

      // Calculate magnification ratios
      const m1 = initialWidthInches / negativeSize;
      const m2 = targetWidthInches / negativeSize;

      // Calculate new exposure time: t2 = t1 * ((m2 + 1) / (m1 + 1))^2
      const targetExposure = initialExposure * Math.pow((m2 + 1) / (m1 + 1), 2);

      document.getElementById('result').innerText =
        `Initial magnification: ${m1.toFixed(2)}×\n` +
        `Target magnification: ${m2.toFixed(2)}×\n` +
        `Target Exposure Time: ${targetExposure.toFixed(2)} s`;
    }

    // Load settings on page load
    window.addEventListener('DOMContentLoaded', loadSettings);
  </script>
</body>
</html>

